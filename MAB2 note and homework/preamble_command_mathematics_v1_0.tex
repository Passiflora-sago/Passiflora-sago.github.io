%# -*- coding: utf-8 -*-

% preamble_command_mathematics_v1_0.tex

% ---------- macro definition ----------
% ----- equation setting -----
\everymath{\displaystyle}

% ----- command -----
\newcommand{\les}{\leqslant}
\newcommand{\ges}{\geqslant}
\newcommand{\degree}{^{\circ}}
\newcommand{\circA}{\overset{\circ}{\mathrm{A}}}
\newcommand{\dageq}{\stackrel{\dag}{ = }}
\newcommand{\ddageq}{\stackrel{\ddag}{ = }}
\newcommand{\dbdageq}{\stackrel{\dbdag}{ = }}
\newcommand{\stareq}{\stackrel{*}{ = }}
\newcommand{\dagiff}{\stackrel{\dag}{\iff}}
\newcommand{\ddagiff}{\stackrel{\ddag}{\iff}}
\newcommand{\dagimp}{\stackrel{\dag}{\implies}}
\newcommand{\ddagimp}{\stackrel{\ddag}{\implies}}
\newcommand{\tensor}[1]{\overleftrightarrow{#1}}
% \renewcommand\tensor[1]{\overset{\scriptscriptstyle\leftrightarrow}{#1}}
\renewcommand{\tensor}[1]{\overset{\scriptstyle\leftrightarrow}{#1}}
\newcommand{\by}{\leftarrow}

\newcommand{\join}{\Join}

% \renewcommand\pi{\piup}
\newcommand{\PI}{\uppi}
% \renewcommand\pi{\uppi}
% \renewcommand\pi{\text{\textpi}}
% \renewcommand\pi{\textrm{\greektext p}}

\newcommand{\nimplies}{\centernot\implies}
\newcommand{\nimpliedby}{\centernot\impliedby}

\renewcommand{\Re}{\mathrm{Re}\,}
\renewcommand{\Im}{\mathrm{Im}\,}
\newcommand{\const}{\mathrm{Const.}}
\newcommand{\sym}{\mathrm{sym}}
\newcommand{\cyc}{\mathrm{cyc}}
\newcommand{\ii}{\,\mathrm{i}}
\newcommand{\jj}{\,\mathrm{j}}

\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\dif}{d\!}
\DeclareMathOperator{\diff}{d}
\DeclareMathOperator{\trans}{T}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\grad}{\mathbf{grad}}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\sinc}{sinc}
\DeclareMathOperator{\ad}{ad}
\DeclareMathOperator{\ex}{E}
\DeclareMathOperator{\var}{Var}
\DeclareMathOperator{\argmin}{arg\,min}
\DeclareMathOperator{\argmax}{arg\,max}
\DeclareMathOperator{\softmax}{softmax}
\DeclareMathOperator{\arccot}{arccot}
\DeclareMathOperator{\st}{s.t.}
\DeclareMathOperator{\iid}{i.i.d.}
\DeclareMathOperator{\Exp}{Exp}
\DeclareMathOperator{\Poi}{Poi}

\renewcommand{\parallel}{/\!\!/}

\newcommand{\bR}{\bm{\mathcal{R}}}

\newcommand{\Alpha}{\mathrm{A}}
\newcommand{\Beta}{\mathrm{B}}
\newcommand{\Epsilon}{\mathrm{E}}

\newcommand{\rA}{\mathrm{A}}
\newcommand{\rB}{\mathrm{B}}
\newcommand{\rC}{\mathrm{C}}
\newcommand{\rD}{\mathrm{D}}
\newcommand{\rE}{\mathrm{E}}
\newcommand{\rF}{\mathrm{F}}
\newcommand{\rG}{\mathrm{G}}
\newcommand{\rH}{\mathrm{H}}
\newcommand{\rI}{\mathrm{I}}
\newcommand{\rJ}{\mathrm{J}}
\newcommand{\rK}{\mathrm{K}}
\newcommand{\rL}{\mathrm{L}}
\newcommand{\rM}{\mathrm{M}}
\newcommand{\rN}{\mathrm{N}}
\newcommand{\rO}{\mathrm{O}}
\newcommand{\rP}{\mathrm{P}}
\newcommand{\rQ}{\mathrm{Q}}
\newcommand{\rR}{\mathrm{R}}
\newcommand{\rS}{\mathrm{S}}
\newcommand{\rT}{\mathrm{T}}
\newcommand{\rU}{\mathrm{U}}
\newcommand{\rV}{\mathrm{V}}
\newcommand{\rW}{\mathrm{W}}
\newcommand{\rX}{\mathrm{X}}
\newcommand{\rY}{\mathrm{Y}}
\newcommand{\rZ}{\mathrm{Z}}
\newcommand{\ra}{\mathrm{a}}
\newcommand{\rb}{\mathrm{b}}
\newcommand{\rc}{\mathrm{c}}
\newcommand{\rd}{\mathrm{d}}
\newcommand{\re}{\mathrm{e}}
\newcommand{\rf}{\mathrm{f}}
\newcommand{\rg}{\mathrm{g}}
\newcommand{\rh}{\mathrm{h}}
\newcommand{\ri}{\mathrm{i}}
\newcommand{\rj}{\mathrm{j}}
\newcommand{\rk}{\mathrm{k}}
\newcommand{\rl}{\mathrm{l}}
\renewcommand{\rm}{\mathrm{m}}
\newcommand{\rn}{\mathrm{n}}
\newcommand{\ro}{\mathrm{o}}
\newcommand{\rp}{\mathrm{p}}
\renewcommand{\rq}{\mathrm{q}}
\newcommand{\rr}{\mathrm{r}}
\newcommand{\rs}{\mathrm{s}}
\newcommand{\rt}{\mathrm{t}}
\newcommand{\ru}{\mathrm{u}}
\newcommand{\rv}{\mathrm{v}}
\newcommand{\rw}{\mathrm{w}}
\newcommand{\rx}{\mathrm{x}}
\newcommand{\ry}{\mathrm{y}}
\newcommand{\rz}{\mathrm{z}}

\newcommand{\0}{\bm{0}}
\newcommand{\1}{\bm{1}}
\newcommand{\A}{\bm{A}}
\newcommand{\B}{\bm{B}}
\newcommand{\C}{\bm{C}}
\newcommand{\D}{\bm{D}}
\newcommand{\E}{\bm{E}}
\newcommand{\F}{\bm{F}}
\newcommand{\G}{\bm{G}}
\renewcommand{\H}{\bm{H}}
\newcommand{\I}{\bm{I}}
\newcommand{\J}{\bm{J}}
\newcommand{\K}{\mathbb{K}}
\renewcommand{\L}{\bm{L}}
\newcommand{\M}{\bm{M}}
\newcommand{\N}{\mathbb{N}}
\renewcommand{\O}{\bm{O}}
\renewcommand{\P}{\bm{P}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\S}{\bm{S}}
\newcommand{\T}{\bm{T}}
\newcommand{\U}{\bm{U}}
\newcommand{\V}{\bm{V}}
\newcommand{\W}{\bm{W}}
\newcommand{\X}{\bm{X}}
\newcommand{\Y}{\bm{Y}}
\newcommand{\Z}{\mathbb{Z}}
\renewcommand{\a}{\bm{a}}
\renewcommand{\b}{\bm{b}}
\renewcommand{\c}{\bm{c}}
\renewcommand{\d}{\bm{d}}
\newcommand{\e}{\mathrm{e}}
\newcommand{\f}{\bm{f}}
\newcommand{\g}{\bm{g}}
\newcommand{\h}{\bm{h}}
\renewcommand{\i}{\bm{i}}
\renewcommand{\j}{\bm{j}}
\renewcommand{\k}{\bm{k}}
\renewcommand{\l}{\bm{l}}
\newcommand{\m}{\bm{m}}
\newcommand{\n}{\bm{n}}
\renewcommand{\o}{\bm{o}}
\newcommand{\p}{\bm{p}}
\newcommand{\q}{\bm{q}}
% \renewcommand\r{\bm{r}}
\newcommand{\br}{\bm{r}}
\newcommand{\s}{\bm{s}}
\renewcommand{\t}{\bm{t}}
\renewcommand{\u}{\bm{u}}
\renewcommand{\v}{\bm{v}}
\newcommand{\w}{\bm{w}}
\newcommand{\x}{\bm{x}}
\newcommand{\y}{\bm{y}}
\newcommand{\z}{\bm{z}}

\newcommand{\balpha}{\bm{\alpha}}
\newcommand{\bbeta}{\bm{\beta}}
\newcommand{\bchi}{\bm{\chi}}
\newcommand{\bdelta}{\bm{\delta}}
\newcommand{\bvarepsilon}{\bm{\varepsilon}}
\newcommand{\bphi}{\bm{\phi}}
\newcommand{\bvarphi}{\bm{\varphi}}
\newcommand{\bgamma}{\bm{\gamma}}
\newcommand{\bmeta}{\bm{\eta}}
\newcommand{\biota}{\bm{\iota}}
\newcommand{\bkappa}{\bm{\kappa}}
\newcommand{\blambda}{\bm{\lambda}}
\newcommand{\bvarLambda}{\bm{\varLambda}}
\newcommand{\bmu}{\bm{\mu}}
\newcommand{\bnu}{\bm{\nu}}
\newcommand{\bpi}{\bm{\pi}}
\newcommand{\bvarpi}{\bm{\varpi}}
\newcommand{\btheta}{\bm{\theta}}
\newcommand{\bvartheta}{\bm{\vartheta}}
\newcommand{\brho}{\bm{\rho}}
\newcommand{\bsigma}{\bm{\sigma}}
\newcommand{\bvarsigma}{\bm{\varsigma}}
\newcommand{\btau}{\bm{\tau}}
\newcommand{\bupsilon}{\bm{\upsilon}}
\newcommand{\bomega}{\bm{\omega}}
\newcommand{\bxi}{\bm{\xi}}
\newcommand{\bpsi}{\bm{\psi}}
\newcommand{\bzeta}{\bm{\zeta}}
\newcommand{\bAlpha}{\bm{\Alpha}}
\newcommand{\bBeta}{\bm{\Beta}}
\newcommand{\bChi}{\bm{\Chi}}
\newcommand{\bDelta}{\bm{\Delta}}
\newcommand{\bEpsilon}{\bm{\Epsilon}}
\newcommand{\bPhi}{\bm{\Phi}}
\newcommand{\bGamma}{\bm{\Gamma}}
\newcommand{\bEta}{\bm{\Eta}}
\newcommand{\bIota}{\bm{\Iota}}
\newcommand{\bKappa}{\bm{\Kappa}}
\newcommand{\bLambda}{\bm{\Lambda}}
\newcommand{\bMu}{\bm{\Mu}}
\newcommand{\bNu}{\bm{\Nu}}
\newcommand{\bPi}{\bm{\Pi}}
\newcommand{\bTheta}{\bm{\Theta}}
\newcommand{\bRho}{\bm{\Rho}}
\newcommand{\bSigma}{\bm{\Sigma}}
\newcommand{\bvarSigma}{\bm{\varSigma}}
\newcommand{\bTau}{\bm{\Tau}}
\newcommand{\bUpsilon}{\bm{\Upsilon}}
\newcommand{\bOmega}{\bm{\Omega}}
\newcommand{\bXi}{\bm{\Xi}}
\newcommand{\bPsi}{\bm{\Psi}}
\newcommand{\bZeta}{\bm{\Zeta}}
\newcommand{\ve}{\varepsilon}
\newcommand{\laplace}{\Delta}

% 启用 expl3 语法处理多个变量
\ExplSyntaxOn

% 定义 \parfrac 宏，默认阶数为 1，支持多个变量
\NewDocumentCommand{\parfrac}{O{1} m m}
{
  \frac{
    \int_compare:nNnTF {#1} = {1} {\partial #2} {\partial^{#1} #2}
  }
  {
    \parfrac_process_vars:n { #3 }
  }
}

% 处理逗号分隔的多个偏导变量
\cs_new_protected:Nn \parfrac_process_vars:n
{
  \seq_set_split:Nnn \l_tmpa_seq { , } { #1 }
  \seq_map_inline:Nn \l_tmpa_seq { \partial ##1 }
}

\ExplSyntaxOff